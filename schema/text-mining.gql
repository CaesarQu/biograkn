define

# common attributes
confidence sub attribute, datatype double;

pubmed-article sub entity,
  has pmid,
  has title,
  has annotated-abstract,
  plays mined-text;

pmid sub attribute, datatype string;
title sub attribute, datatype string;
annotated-abstract sub attribute, datatype string,
  plays abstract-container,
  plays owner;

sentence sub entity,
  has sentiment,
  has text,
  plays contained-sentence,
  plays sentence-container,
  plays mentioning-sentence;

sentiment sub attribute, datatype string;
text sub attribute, datatype string;

token sub entity,
  has start-position,
  has end-position,
  has tag,
  has ner,
  has lemma,
  plays contained-token,
  plays object,
  plays subject;

start-position sub attribute, datatype double;
end-position sub attribute, datatype double;
tag sub attribute, datatype string;
ner sub attribute, datatype string,
    has confidence;
lemma sub attribute, datatype string;

mined-relation sub relation,
    has relation-type,
    has confidence,
    relates object,
    relates subject,
    relates mentioning-sentence,
    plays extracted-relation,
    plays extracted-knowledge;

relation-type sub attribute, datatype string;

entity-mention sub entity,
    has value,
    has entity-type,
    plays mentioned-entity,
    plays containing-entity;

entity-type sub attribute, datatype string;
value sub attribute, datatype string;

mention sub relation,
    relates mentioned-entity,
    relates mentioning-sentence,
    plays owned,
    plays representative;

coref-chain sub relation,
    has chain-id,
    relates owner,
    relates owned,
    relates representative;

chain-id sub attribute, datatype double;


abstract-containing-sentence sub relation,
    relates abstract-container,
    relates contained-sentence;

sentence-containing-token sub relation,
    relates sentence-container,
    relates contained-token;

entity-containing-token sub relation,
    relates containing-entity,
    relates contained-token;

entity-extraction sub relation,
    relates extracted-entity,
    relates mined-text;

relation-extraction sub relation,
    relates extracted-relation,
    relates mined-text;

#test1 sub rule,
#when {
#    (representative: $r, owned: $o) isa coref-chain;
#    $o (mentioned-entity: $e) isa mention;
#    (containing-entity: $e, contained-token: $t) isa entity-containing-token;
#    (subject: $t, mentioning-sentence: $s, object: $ob) isa mined-relation, has confidence $c, has relation-type $rt;
#
#    $r (mentioned-entity: $e2) isa mention;
#    ($e2, $t2) isa entity-containing-token;
#},
#then {
#    (subject: $t2, mentioning-sentence: $s, object: $ob) isa mined-relation;
#};
#
#test2 sub rule,
#  when {
#      (representative: $r, owned: $o) isa coref-chain;
#      $o (mentioned-entity: $e) isa mention;
#      (containing-entity: $e, contained-token: $t) isa entity-containing-token;
#      (subject: $t, mentioning-sentence: $s, object: $ob) isa mined-relation, has confidence $c, has relation-type $rt;
#
#      $r (mentioned-entity: $e2) isa mention;
#      ($e2, $t2) isa entity-containing-token;
#      $mr2 (subject: $t2, mentioning-sentence: $s, object: $ob) isa mined-relation;
#  },
#  then {
#      $mr2 has confidence $c;
#  };
#
# test3 sub rule,
# when {
#     (representative: $r, owned: $o) isa coref-chain;
#     $o (mentioned-entity: $e) isa mention;
#     (containing-entity: $e, contained-token: $t) isa entity-containing-token;
#     (subject: $t, mentioning-sentence: $s, object: $ob) isa mined-relation, has confidence $c, has relation-type $rt;
#
#     $r (mentioned-entity: $e2) isa mention;
#     ($e2, $t2) isa entity-containing-token;
#     $mr2 (subject: $t2, mentioning-sentence: $s, object: $ob) isa mined-relation;
# },
# then {
#     $mr2 has relation-type $rt;
# };




knowledge-extraction sub relation,
    relates extracted-knowledge,
    relates mined-text;
## extracted entityies




#test1 sub rule,
#when {
#   $p isa pubmed-article, has annotated-abstract $a;
#   ($a, $s) isa abstract-containing-sentence;
#   ($s, $e) isa mention;
#},
#then {
#  (extracted-entity: $e, mined-text: $p) isa entity-extraction;
#};

#test2 sub rule,
#when {
#   $p isa pubmed-article, has annotated-abstract $a;
#   ($a, $s) isa abstract-containing-sentence;
#   $mr ($s, $o, $su) isa mined-relation;
#},
#then {
#  (extracted-relation: $mr, mined-text: $p) isa relation-extraction;
#};


treatment-rule sub rule,
when {
  $p isa pubmed-article, has annotated-abstract $a;
  $s isa sentence;
  ($a, $s) isa abstract-containing-sentence;
  ($s, $object, $subject) isa mined-relation, has relation-type "treatment";
  $object has lemma $l1;
  $subject has lemma $l2;
  $object has ner $n1;
  $subject has ner $n2;
  $drug isa drug, has name $drug-name;
  $drug-name == $l1;
  $disease isa disease, has name $disease-name;
  $disease-name == $l2;
},
then {
   (therapeutic: $drug, treated-condition: $disease) isa treatment;
};

